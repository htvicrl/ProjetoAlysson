<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel de Controle - SQL</title>
    <link rel="stylesheet" href="{{ static_url('css/style.css') }}">
</head>
<body>
    <nav style="text-align: center; margin-bottom: 20px;">
        <a href="/tarefas">Voltar para Tarefas</a>
    </nav>

    <h1 style="text-align:center;">Painel de Auditoria (SQL Avan√ßado)</h1>

    <div class="card">
        <h2>1. Dados da VIEW (vw_detalhes_tarefas)</h2>
        <p><small>Esta tabela abaixo n√£o existe fisicamente, ela √© uma VIEW que une Usuario, Tarefas, Categorias e Status.</small></p>
        <table border="1" style="width: 100%; border-collapse: collapse;">
            <tr style="background: #eee;">
                <th>ID</th><th>T√≠tulo</th><th>Categoria</th><th>Status</th><th>Dono</th>
            </tr>
            {% for id, titulo, desc, cat, status, dono in tarefas_view %}
            <tr>
                <td>{{ id }}</td><td>{{ titulo }}</td><td>{{ cat }}</td><td>{{ status }}</td><td>{{ dono }}</td>
            </tr>
            {% end %}
        </table>
    </div>

    <div class="card" style="margin-top: 30px;">
        <h2>2. Logs de Auditoria (Gerados por TRIGGERS)</h2>
        <p><small>Sempre que voc√™ Criar, Editar ou Deletar, um Trigger insere uma linha aqui automaticamente.</small></p>
        <ul style="list-style: none; padding: 0;">
            {% for id_log, id_tarefa, acao, data in logs %}
            <li style="padding: 10px; border-bottom: 1px solid #ddd;">
                <strong>[{{ data }}]</strong> - Tarefa #{{ id_tarefa }}: {{ acao }}
            </li>
            {% end %}
        </ul>
    </div>
    <div style="max-width: 900px; margin: auto;">
        <h1 style="text-align:center;">Painel de SQL Avan√ßado</h1>
        <p style="text-align:center;"><a href="/tarefas">‚Üê Voltar para o Dashboard</a></p>

        <div class="card" style="background: #2b2d42; color: #fff;">
            <h2 style="color: #4361ee; text-align: left;">üìÑ Defini√ß√µes SQL (Views e Triggers)</h2>
            <p>Abaixo est√£o os comandos SQL executados no banco de dados para este projeto:</p>

            <h3 style="color: #2ec4b6;">1. Cria√ß√£o da View Consolidada</h3>
            <pre style="background: #1a1c2c; padding: 15px; border-radius: 8px; overflow-x: auto;">
<code>CREATE VIEW vw_detalhes_tarefas AS
SELECT
    t.id_tarefa, t.titulo, t.descricao,
    c.nome AS categoria, s.descricao AS status_atual,
    u.nome AS dono_da_tarefa
FROM tarefas t
JOIN usuario u ON t.id_usuario = u.id_usuario
JOIN categorias c ON t.id_categoria = c.id
JOIN status_tarefa s ON t.id_status = s.id;</code></pre>

            <h3 style="color: #2ec4b6;">2. Exemplo de Trigger (Auditoria de Insert)</h3>
            <pre style="background: #1a1c2c; padding: 15px; border-radius: 8px; overflow-x: auto;">
<code>CREATE TRIGGER trg_log_insert AFTER INSERT ON tarefas
BEGIN
    INSERT INTO logs_tarefas (tarefa_id, acao)
    VALUES (NEW.id_tarefa, 'CRIOU: ' || NEW.titulo);
END;</code></pre>
        </div>

        <br>

        <div class="card">
            <h2>üïí Logs Gerados em Tempo Real (Triggers)</h2>
            <div class="log-container">
                {% for id_log, id_tarefa, acao, data in logs %}
                <div class="log-item">
                    <span class="log-date">{{ data }}</span>
                    <span><strong>ID Tarefa #{{ id_tarefa }}:</strong> {{ acao }}</span>
                </div>
                {% end %}
            </div>
        </div>
    </div>
</body>
</html>